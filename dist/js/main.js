var DrillDownMenu=function(a){this.items=new DrillDownMenuItems,this.view=new DrillDownMenuView({items:this.items}).render(),this.initialize(a)};DrillDownMenu.prototype.initialize=function(a){var b=this;a.forEach(function(a){b.addMenuItem(b.items,a)})},DrillDownMenu.prototype.getView=function(){return this.view},DrillDownMenu.prototype.setItems=function(a){this.items.reset(),this.initialize(a)},DrillDownMenu.prototype.addMenuItem=function(a,b){b.hasOwnProperty("children")?this.addMenuItems(a,b):a.add(new DrillDownMenuItem({title:b.title}))},DrillDownMenu.prototype.addMenuItems=function(a,b){var c=new DrillDownMenuItems({title:b.title});a.add(c);var d=this;b.children.forEach(function(a){d.addMenuItem(c,a)})};var DrillDownMenuItem=Backbone.Model.extend({}),DrillDownMenuItemView=Backbone.View.extend({tagName:"li",template:_.template("<a><%= title %></a>"),events:{"click a":"onClick"},initialize:function(){this.listenTo(this.model,"add",this.addItem),this.listenTo(this.model,"change:isOpen",this.open)},render:function(){return this.$el.html(this.template({title:this.model.attributes.title})),this.hasMenuItems()&&(this.$list=$("<ul></ul>"),this.$list.addClass("drilldown-menu"),this.$el.append(this.$list)),this},addItem:function(a){this.$list&&this.$list.append(new DrillDownMenuItemView({model:a}).render().el)},onClick:function(a){this.hasMenuItems()&&(a.stopPropagation(),this.model.set("isOpen",!0))},open:function(){this.$el.parent().addClass("drilldown-menu-hide")},hasMenuItems:function(){return this.model instanceof DrillDownMenuItems}}),DrillDownMenuItems=Backbone.Model.extend({initialize:function(){this.collection=new Backbone.Collection},add:function(a){this.collection.add(a),this.listenTo(a,"change:isOpen",this.propagateOpenEvent),this.trigger("add",a)},reset:function(){this.collection.reset(),this.trigger("reset")},propagateOpenEvent:function(a){this.trigger("change:isOpen",a)}}),DrillDownMenuView=Backbone.View.extend({className:"drilldown drilldown-hide",template:_.template('<button class="drilldown-menu-return btn btn-default"><span class="glyphicon glyphicon-backward"></span></button><button class="drilldown-menu-close btn btn-default"><span class="glyphicon glyphicon-remove"></span></button><ul class="drilldown-menu" />'),events:{"click .drilldown-menu-return":"return","click .drilldown-menu-close":"close"},defaults:{headerHeight:32,itemViewHeight:41},initialize:function(a){this.itemViews=[],this.items=a.items,this.listenTo(this.items,"add",this.addOne),this.listenTo(this.items,"reset",this.render),this.listenTo(this.items,"change:isOpen",this.delayedResize)},render:function(){return this.$el.html(this.template()),this},addOne:function(a){var b=new DrillDownMenuItemView({model:a});this.itemViews.push(b),this.getList().append(b.render().el),this.resize(this.items)},getList:function(){return this.$("> ul")},getItemView:function(a){return this.itemViews[a]},getReturnBtn:function(){return this.$(".drilldown-menu-return")},getCloseBtn:function(){return this.$(".drilldown-menu-close")},"return":function(){this.$(".drilldown-menu-hide").removeClass("drilldown-menu-hide"),this.resize(this.items)},close:function(){this.$el.addClass("drilldown-hide")},open:function(){this.$el.removeClass("drilldown-hide")},resize:function(a){this.$el.height(this.defaults.headerHeight+a.collection.length*this.defaults.itemViewHeight)},delayedResize:function(a){var b=this;setTimeout(function(){b.resize(a)},500)}});+function(a){var b=function(a,b){this.$input=a;var c=new DrillDownMenu(b.items);this.appendMenuToInput(c,a).registerClickEvent(a,c).registerKeyupEvent(a,c,b).registerBlurEvent(c)};b.DEFAULTS={items:[],isValid:function(a,b){return new RegExp(b,"i").test(a.title)}},b.prototype.appendMenuToInput=function(a,b){return b.after(a.getView().$el),this},b.prototype.registerClickEvent=function(a,b){return a.on("click.drilldown",function(a){a.stopPropagation(),b.getView().open()}),this},b.prototype.registerKeyupEvent=function(a,b,c){var d=this;return a.keyup(function(){var a=[],e=function(b){a.push(b)};d.traverseItems(c.items,c.isValid,e),b.setItems(a)}),this},b.prototype.registerBlurEvent=function(b){a(document).on("click.drilldown",function(){b.getView().close()})},b.prototype.traverseItems=function(a,b,c){var d=this;a.forEach(function(a){a.hasOwnProperty("children")?d.traverseItems(a.children,b,c):b(a,d.getInputValue())&&c(a)})},b.prototype.getInputValue=function(){return this.$input.val()},a.fn.drilldown=function(c){var d=a.extend({},b.DEFAULTS,c);return this.each(function(){{var c=a(this);new b(c,d)}})}}(jQuery);